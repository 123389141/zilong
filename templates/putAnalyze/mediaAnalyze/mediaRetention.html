{% extends "base.html" %}
{% block content %}

<div class="breadcrumbs ace-save-state" id="breadcrumbs">
    <ul class="breadcrumb">
        <li>
            <i class="ace-icon fa fa-home home-icon"></i>
            <a href="/">首页</a>
        </li>
        <li>
            <a href="#">投放分析</a>
        </li>
        <li>
            <a href="#">媒体分析</a>
        </li>
        <li class="active">媒体概览</li>
    </ul><!-- /.breadcrumb -->
</div>
<div class="page-content">

    <script type="text/javascript" src="/static/js/bootstrap-table.js"></script>
    <script type="text/javascript" src="/static/js/bootstrap-table-multiple-sort.js"></script>

    <link rel="stylesheet" href="/static/css/bootstrap-table.css">
    <link rel="stylesheet" href="/static/css/Fliter.css">

    <div class="btn-group">
        <button id ="time_1" type="button" class="btn btn-white btn-sm btn-primary">昨日</button>
        <button id ="time_2" type="button" class="btn btn-white btn-sm btn-primary">前日</button>
        <button id ="time_7" type="button" class="btn btn-white btn-sm btn-primary">近7天</button>
        <button id ="time_15" type="button" class="btn btn-white btn-sm btn-primary">近15天</button>
        <button id ="time_30" type="button" class="btn btn-white btn-sm btn-primary">近30天</button>
        <button id ="timeAll" type="button" class="btn btn-white btn-sm btn-primary">历史所有</button>
        <!--<button id ="timeFromTo" type="button" class="btn btn-white btn-sm btn-primary">2017-02-01 -&#45;&#45; 2017-02-30</button>-->
    </div>|
    <input id="timeFrom" type="date" class="btn btn-white btn-sm btn-primary" value="" style="height:27px">--
    <input id="timeTo" type="date" class="btn btn-white btn-sm btn-primary" value="" style="height:27px">

    <p></p>
    <div>
        <div id="demo1"></div>
        <div id="demo2"></div>
        <div id="demo3"></div>

        <div align="center">
            <button id="chaxun" class="btn btn-white btn-sm btn-primary">查询</button>
        </div>
    </div>
    <div class="hr hr-8 hr-dotted"></div>
    
<div id="main-widget-container" >
       

            <div class=" col-sm-6 widget-container-col ui-sortable" id="widget-container-col-1">
                                                        <div class="widget-box ui-sortable-handle" id="widget-box-1"  >
                                                            <div class="widget-header">
                                                                <h5 class="widget-title">用户留存情况</h5>

                                                                <div class="widget-toolbar">
                                                                    <div class="widget-menu">
                                                                        <a href="#" data-action="settings" data-toggle="dropdown" aria-expanded="false">
                                                                            <i class="ace-icon fa fa-bars"></i>
                                                                        </a>

                                                                        <ul class="dropdown-menu dropdown-menu-right dropdown-light-blue dropdown-caret dropdown-closer">
                                                                            <li class="active">
                                                                                <a data-toggle="tab" href="#dropdown1" aria-expanded="true">留存量</a>
                                                                            </li>

                                                                            <li class="active">
                                                                                <a data-toggle="tab" href="#dropdown2" aria-expanded="true">留存率</a>
                                                                            </li>
                                                                        </ul>
                                                                    </div>

                                                  
                                                                    </a>

                                                                    <a href="#" data-action="reload">
                                                                        <i class="ace-icon fa fa-refresh"></i>
                                                                    </a>

                                                                    <a href="#" data-action="collapse">
                                                                        <i class="ace-icon fa fa-chevron-up"></i>
                                                                    </a>

                                                                    <a href="#" data-action="close">
                                                                        <i class="ace-icon fa fa-times"></i>
                                                                    </a>
                                                                </div>
                                                            </div>
                                                            <div class="widget-body">
        <table id="table" data-sort-name="date_time" data-sort-order="desc" class="table table-no-bordered "
        data-pagination="true"  
        data-page-list="[10,20,50,100]"
        data-height="300"
        >
            <thead>
                <tr>
                    <th data-field="game_id" data-sortable="true"  >游戏名称</th>
                    <th data-field="platform" data-sortable="true" >平台</th>
                    <th data-field="channel_name" data-sortable="true"  >渠道</th>
                    <th data-field="agent" data-sortable="true" >代理商</th>
                    <th data-field="staff" data-sortable="true"  >负责人</th>
                    <th data-field="date_" data-sortable="true">　日期　</th>
                    <th data-field="re_0" data-sortable="true">day0</th>
                    <th data-field="re_1" data-sortable="true">day1</th>
                    <th data-field="re_2" data-sortable="true">day2</th>
                    <th data-field="re_3" data-sortable="true">day3</th>
                    <th data-field="re_4" data-sortable="true">day4</th>
                    <th data-field="re_5" data-sortable="true">day5</th>
                    <th data-field="re_6" data-sortable="true">day6</th>


                </tr>
            </thead>
        </table>
                                                            </div>
                                                        </div>
            </div>
   

            <div class="col-xs-12 col-sm-6 widget-container-col ui-sortable" id="widget-container-col-1" style="min-height: 210px;">
                                                                <div class="widget-box ui-sortable-handle" id="widget-box-1" style="opacity: 1;">
                                                                    <div class="widget-header">
                                                                        <h5 class="widget-title">Default Widget Box</h5>

                                                                        <div class="widget-toolbar">
                                                                            <div class="widget-menu">
                                                                                <a href="#" data-action="settings" data-toggle="dropdown" aria-expanded="false">
                                                                                    <i class="ace-icon fa fa-bars"></i>
                                                                                </a>

                                                                                <ul class="dropdown-menu dropdown-menu-right dropdown-light-blue dropdown-caret dropdown-closer">
                                                                                    <li class="active">
                                                                                        <a data-toggle="tab" href="#dropdown1" aria-expanded="true">Option#1</a>
                                                                                    </li>

                                                                                    <li class="active">
                                                                                        <a data-toggle="tab" href="#dropdown2" aria-expanded="true">Option#2</a>
                                                                                    </li>
                                                                                </ul>
                                                                            </div>

                                                                            

                                                                            <a href="#" data-action="reload">
                                                                                <i class="ace-icon fa fa-refresh"></i>
                                                                            </a>

                                                                            <a href="#" data-action="collapse">
                                                                                <i class="ace-icon fa fa-chevron-up"></i>
                                                                            </a>

                                                                            <a href="#" data-action="close">
                                                                                <i class="ace-icon fa fa-times"></i>
                                                                            </a>
                                                                        </div>
                                                                    </div>

                                                                    <div class="widget-body" style="display: block;">
                                                                        <div class="widget-main ace-scroll scroll-disabled" style="position: relative;"><div class="scroll-track" style="display: none;"><div class="scroll-bar" style="top: 0px;"></div></div><div class="scroll-content">
                                                                            <p class="alert alert-info">
                                                                                Nunc aliquam enim ut arcu aliquet adipiscing. Fusce dignissim volutpat justo non consectetur. Nulla fringilla eleifend consectetur.
                                                                            </p>
                                                                            <p class="alert alert-success">
                                                                                Raw denim you probably haven't heard of them jean shorts Austin.
                                                                            </p>
                                                                        </div></div>
                                                                    </div>
                                                                </div>
                    </div>
           


</div>

</div>

</div><!-- /.page-content -->

<script>
    var $table = $('#table');

    $(function () {


    $("#table").bootstrapTable({
        url: "/analyze/mediaRetentionJson?{{sjs}}&channel_name&agent&staff",
        pagination: true, //开启分页
        pageSize: 10,
    });

       $table.bootstrapTable('hideColumn', 'game_id');
       $table.bootstrapTable('hideColumn', 'platform');
       $table.bootstrapTable('hideColumn', 'channel_name');
       $table.bootstrapTable('hideColumn', 'agent');
       $table.bootstrapTable('hideColumn', 'staff');
    });

</script>


























<script type="text/javascript">

    var demo1 = null;
    var channel_name = [];

    var demo2 = null;
    var agent = [];

    var demo3 = null;
    var staff = [];

    $.getJSON("/analyze/mediaOverviewJsonTJ?{{sjs}}", function(data){
        for(var i = 0 ; i<data.length ; i++){
            var flagId=data[i]["channel_name"];
            var flagText=data[i]["channel_name"];
            if(channel_name.length != 0){ //判断数组是否为空,为空直接就push
                var flag = true;
                for(var j = 0 ; j<channel_name.length ; j++){
                    if(channel_name[j]["id"] == flagId){
                        flag = false;
                    }
                }
                if(flag){
                    channel_name.push({"id": flagId ,"text": flagText});
                }
            }else{
                channel_name.push({"id": flagId ,"text": flagText});
            }
        }

        demo1 = $('#demo1').comboboxfilter({
            url: '',
            text: "渠道",
            scope: 'FilterQuery3',
            multiple: true,
            data:channel_name,
            onChange:function(newValue){
            $('#demo10').val(newValue);
                newValue1 = newValue;
            }
        });


        for(var i = 0 ; i<data.length ; i++){
            var flagId=data[i]["agent"];
            var flagText=data[i]["agent"];
            if(agent.length != 0){ //判断数组是否为空,为空直接就push
                var flag = true;
                for(var j = 0 ; j<agent.length ; j++){
                    if(agent[j]["id"] == flagId){
                        flag = false;
                    }
                }
                if(flag){
                    agent.push({"id": flagId ,"text": flagText});
                }
            }else{
                agent.push({"id": flagId ,"text": flagText});
            }
        }

        demo2 = $('#demo2').comboboxfilter({
            url: '',
            text: "代理商",
            scope: 'FilterQuery3',
            multiple: true,
            data:agent,
            onChange:function(newValue){
                $('#demo20').val(newValue);
            newValue1 = newValue;
            }
        });


        for(var i = 0 ; i<data.length ; i++){
            var flagId=data[i]["staff"];
            var flagText=data[i]["staff"];
            if(staff.length != 0){ //判断数组是否为空,为空直接就push
                var flag = true;
                for(var j = 0 ; j<staff.length ; j++){
                    if(staff[j]["id"] == flagId){
                        flag = false;
                    }
                }
                if(flag){
                    staff.push({"id": flagId ,"text": flagText});
                }
            }else{
                staff.push({"id": flagId ,"text": flagText});
            }
        }

        demo3 = $('#demo3').comboboxfilter({
            url: '',
            text: "负责人",
            scope: 'FilterQuery3',
            multiple: true,
            data:staff,
            onChange:function(newValue){
                $('#demo30').val(newValue);
            newValue1 = newValue;
            }
        });
    });


    // 时间筛选+条件筛选
    $("#chaxun").click(function(){
        console.log(demo1.returnValue($("#demo1")));
        console.log(demo2.returnValue($("#demo2")));
        console.log(demo3.returnValue($("#demo3")));

        var fromTime = $("#timeFrom").val();
        var toTime = $("#timeTo").val();

        var fromTimeCuo = Date.parse(new Date(fromTime));
        var toTimeCuo = Date.parse(new Date(toTime));
        var tianshu = (toTimeCuo - fromTimeCuo)/1000/60/60/24;

        var fromToTime = [fromTime];
        var flag = fromTimeCuo
        for (var i = 0 ; i < tianshu ; i++ ){
            flag = flag+1000*60*60*24;
            fromToTime.push( new Date(flag).Format("yyyy-MM-dd") );
        }

        var channel_name_filter = demo1.returnValue($("#demo1"));

        var agent_filter = demo2.returnValue($("#demo2"));

        var staff_filter = demo3.returnValue($("#demo3"));

        $("#table").bootstrapTable('refresh',{url: "/analyze/mediaOverviewJson?{{sjs}}&channel_name=" + channel_name_filter + "&agent=" + agent_filter + "&staff=" + staff_filter} );

        $("#table").bootstrapTable('filterBy',{
            date_time : fromToTime,
        });

        //条件筛选完成后,重新设置 piece chart
        setTimeout("setPieceChart();",2000);

    });

{% endblock content %}